<section class="top-employee">
  <div class="container">
    <%= image_tag "top_employee.png", class:"top-image" %>
    <h2><span class="title">Les tops employés</span></h2>
    <div class="cards">
     <% top_employees.each do |top_employee| %>
      <div class="card card-animate shadow">
        <div class="card-gradient">
          <div class="card-avatar">
            <%= cl_image_tag top_employee.avatar.key, width: 100, height: 100, crop: :fill %>
          </div>
        </div>
        <div class="card-info">
          <p class="card-job"><%= top_employee.job_title %></p>
                    <!-- Ajout fonctionnalité rating -->
          <%
          reviews_employee = Review.where(employee: top_employee.id)
          total_rating = 0
          if reviews_employee.present?
            reviews_employee.each do |review_employee|
              total_rating += review_employee.rating
            end
            if reviews_employee
            average_rating = (total_rating / reviews_employee.count).round
            end
          end
          %>
          <% if average_rating != nil %>
            <% stars= average_rating %>
            <% stars.times do  %>
             <i class="fa-solid fa-star pink"></i>
            <% end %>
             <% end %>
               <!-- Fin Ajout fonctionnalité rating -->
          <p class="card-price"><span class="span-blue"><%= top_employee.price_per_day %> €</span></p>
          <%= link_to "Plus d'informations", employee_path(top_employee), class:"button-blue btn-center" %>
        </div>
      </div>
      <% end %>
    </div>
  </div>
</section>
<hr id="pink">
